#!/bin/bash
set -e

echo "ğŸ”„ Aguardando PostgreSQL..."

# Espera o PostgreSQL estar pronto
until pg_isready -h postgres -p 5432 -U postgres > /dev/null 2>&1; do
  echo "â³ PostgreSQL nÃ£o estÃ¡ pronto ainda - aguardando..."
  sleep 2
done

echo "âœ… PostgreSQL estÃ¡ pronto!"

# Remove pid antigo se existir
rm -rf tmp/pids/server.pid

# Instala dependÃªncias
echo "ğŸ“¦ Instalando dependÃªncias..."
bundle install --quiet

# Cria o banco se nÃ£o existir e executa migrations
echo "ğŸ—„ï¸ Configurando banco de dados..."
bundle exec rails db:prepare

echo "ğŸš€ Iniciando servidor Rails..."
exec "$@"
